{{ define "main" }}
<style>
  /* Etiquetas num√©ricas din√°micas */
  .number-label {
    background: none; 
    border: none; 
    font-weight: bold; 
    font-size: 18px; 
    text-shadow: 2px 2px 4px #000;
    text-align: center;
  }

  /* Contenedor del mapa */
  .mapa-full-width { 
    width: 100%; 
    max-width: 1200px; /* evita que sobrepase pantallas grandes */
    height: 65vh;       /* altura relativa, adapta a pantallas peque√±as */
    min-height: 400px;  /* m√≠nimo aceptable en m√≥viles */
    margin: 0 auto;
    border: 2px solid #333; 
    border-radius: 4px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }

  /* Contenedor del Radar - Tama√±o Controlado */
  .radar-section {
    margin-top: 40px;
    padding: 30px;
    background: #ffffff;
    border-radius: 12px;
    border: 1px solid #ddd;
    color: #333;
  }

  .radar-wrapper {
    max-width: 600px;
    width: 90%;
    margin: 0 auto; /* centrado horizontal */
  }

  /* Ajuste responsivo de texto y contenedores */
  @media (max-width: 768px) {
    .post-content {
        font-size: 1em;
    }
    .radar-wrapper {
        width: 100%;
        padding: 0 10px;
    }
    .number-label {
        font-size: 14px;
    }
  }
</style>

<div class="post">
    <h1 class="post-title">{{ .Title }}</h1>
    
    <div id="map" class="mapa-full-width"></div>

    <div class="post-content" style="margin: 30px 0; color: #555; font-family: monospace; font-size: 1.1em;">
        {{ .Content }}
    </div>

    <div class="radar-section">
        <h2 style="text-align: center; margin-top: 0; font-family: sans-serif; color: #222;">üìä Monitor de Tensi√≥n Geopol√≠tica</h2>
        <div class="radar-wrapper">
            {{ readFile "layouts/shortcodes/radar_intel.html" | safeHTML }}
        </div>
        <p style="text-align: center; font-size: 0.85em; color: #777; margin-top: 15px;">
            An√°lisis din√°mico de sentimiento y volumen por regi√≥n.
        </p>
    </div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    var map = L.map('map').setView([20.0, 0.0], 2);    

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '¬© OpenStreetMap | Intel Center OSINT'
    }).addTo(map);

    fetch('https://mcasrom.github.io/intel_center/data/hotspots.json')
        .then(response => response.json())
        .then(data => {
            data.forEach(spot => {
                // Ajuste de radio con l√≠mites para m√≥viles y pantallas grandes
                var baseRadius = Math.max(spot.intensity * 8000, 60000);
                var finalRadius = spot.anomaly ? baseRadius * 1.5 : baseRadius;
                finalRadius = Math.min(finalRadius, 150000);

                var nodeColor = spot.color || '#00ff00'; 

                L.circle([spot.lat, spot.lon], {
                    color: nodeColor, 
                    fillColor: nodeColor,
                    fillOpacity: 0.25, 
                    weight: spot.anomaly ? 5 : 2,
                    radius: finalRadius
                }).addTo(map);

                var numberIcon = L.divIcon({
                    className: 'number-label',
                    html: `<div style="color: ${nodeColor};">${spot.intensity}${spot.anomaly ? '‚ö†' : ''}</div>`,
                    iconSize: [60, 40]
                });

                L.marker([spot.lat, spot.lon], { icon: numberIcon }).addTo(map);
                
                var popupText = `<b>Nodo: ${spot.name}</b><br>Intensidad: ${spot.intensity}<br>Tensi√≥n: ${spot.sentiment_index}`;
                L.marker([spot.lat, spot.lon], { opacity: 0 }).bindPopup(popupText).addTo(map);
            });
        })
        .catch(err => console.error("Error en telemetr√≠a:", err));
</script>
{{ end }}
