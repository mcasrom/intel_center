{{ define "main" }}
<style>
  .number-label {
    background: none; border: none; color: #00ff00;
    font-weight: bold; font-size: 16px; text-shadow: 0 0 5px #000;
    text-align: center;
  }
  .mapa-full-width { width: 100%; border: 1px solid #333; }
</style>

<div class="post">
    <h1 class="post-title">{{ .Title }}</h1>
    <div id="map" class="mapa-full-width" style="height: 650px; background: #1a1b1c;"></div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    var map = L.map('map').setView([20.0, 0.0], 2);    

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // Ruta absoluta para GitHub Pages
    fetch('https://mcasrom.github.io/intel_center/data/hotspots.json')
        .then(response => response.json())
        .then(data => {
            data.forEach(spot => {
                var radius = Math.max(spot.intensity * 15000, 100000); 
                L.circle([spot.lat, spot.lon], {
                    color: '#00ff00', fillColor: '#00ff00',
                    fillOpacity: 0.3, radius: radius
                }).addTo(map);

                var numberIcon = L.divIcon({
                    className: 'number-label',
                    html: `<div>${spot.intensity}</div>`,
                    iconSize: [30, 30]
                });

                L.marker([spot.lat, spot.lon], { icon: numberIcon }).addTo(map);
            });
        })
        .catch(err => console.error("Error cargando datos:", err));
</script>
{{ end }}
