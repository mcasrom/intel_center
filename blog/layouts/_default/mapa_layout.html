{{ define "main" }}
<style>
  /* Etiquetas num칠ricas din치micas */
  .number-label {
    background: none; 
    border: none; 
    font-weight: bold; 
    font-size: 18px; 
    text-shadow: 2px 2px 4px #000;
    text-align: center;
  }
  /* Contenedor del mapa */
  .mapa-full-width { 
    width: 100%; 
    border: 2px solid #333; 
    border-radius: 4px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  /* Contenedor del Radar - Tama침o Controlado */
  .radar-section {
    margin-top: 40px;
    padding: 30px;
    background: #ffffff;
    border-radius: 12px;
    border: 1px solid #ddd;
    color: #333;
  }
  .radar-wrapper {
    max-width: 600px;
    margin: 0 auto; /* Centrado horizontal */
  }
</style>

<div class="post">
    <h1 class="post-title">{{ .Title }}</h1>
    
    <div id="map" class="mapa-full-width" style="height: 650px; background: #1a1b1c;"></div>

    <div class="post-content" style="margin: 30px 0; color: #555; font-family: monospace; font-size: 1.1em;">
        {{ .Content }}
    </div>

    <div class="radar-section">
        <h2 style="text-align: center; margin-top: 0; font-family: sans-serif; color: #222;">游늵 Monitor de Tensi칩n Geopol칤tica</h2>
        <div class="radar-wrapper">
            {{ readFile "layouts/shortcodes/radar_intel.html" | safeHTML }}
        </div>
        <p style="text-align: center; font-size: 0.85em; color: #777; margin-top: 15px;">
            An치lisis din치mico de sentimiento y volumen por regi칩n.
        </p>
    </div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    var map = L.map('map').setView([20.0, 0.0], 2);    

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '춸 OpenStreetMap | Intel Center OSINT'
    }).addTo(map);

    fetch('https://mcasrom.github.io/intel_center/data/hotspots.json')
        .then(response => response.json())
        .then(data => {
            data.forEach(spot => {
                var radius = Math.max(spot.intensity * 18000, 120000); 
                var finalRadius = spot.anomaly ? radius * 2 : radius;
                var nodeColor = spot.color || '#00ff00'; 

                L.circle([spot.lat, spot.lon], {
                    color: nodeColor, 
                    fillColor: nodeColor,
                    fillOpacity: 0.25, 
                    weight: spot.anomaly ? 5 : 2,
                    radius: finalRadius
                }).addTo(map);

                var numberIcon = L.divIcon({
                    className: 'number-label',
                    html: `<div style="color: ${nodeColor};">${spot.intensity}${spot.anomaly ? '丘멆잺' : ''}</div>`,
                    iconSize: [60, 40]
                });

                L.marker([spot.lat, spot.lon], { icon: numberIcon }).addTo(map);
                
                var popupText = `<b>Nodo: ${spot.name}</b><br>Intensidad: ${spot.intensity}<br>Tensi칩n: ${spot.sentiment_index}`;
                L.marker([spot.lat, spot.lon], { opacity: 0 }).bindPopup(popupText).addTo(map);
            });
        })
        .catch(err => console.error("Error en telemetr칤a:", err));
</script>
{{ end }}
